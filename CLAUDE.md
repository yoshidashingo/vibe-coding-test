# CLAUDE.md

このファイルは、このリポジトリでコードを扱う際のClaude Code (claude.ai/code) へのガイダンスを提供します。

## 開発コマンド

- `npm run dev` - Next.js開発サーバーを起動
- `npm run build` - 本番用にアプリケーションをビルド
- `npm run lint` - ESLintでコード品質をチェック
- `npm run seed` - Prismaを使用してデータベースに初期データを投入

## プロジェクトアーキテクチャ

これはNext.js 13+のApp Routerパターンを使用して構築された匿名掲示板システムです。

### データベースアーキテクチャ (Prisma + PostgreSQL)
システムは階層構造に従います：**掲示板(Board)** → **スレッド(Thread)** → **投稿(Post)**

- **User**: 匿名性のためIPアドレスのみで識別
- **Board**: 議論を整理するカテゴリ（例：「技術」「雑談」）
- **Thread**: 掲示板内の議論トピック
- **Post**: スレッド内の個別メッセージ・返信

主要な関係性：
- 掲示板は複数のスレッドを含む
- スレッドは複数の投稿を含む
- ユーザーはIPアドレスで投稿にリンク（モデレーション用）
- 投稿はオプションでニックネーム、トリップ、画像URLをサポート

### ファイル構造パターン

**APIルート** (`app/api/`)：
- Next.js 13+の規約に従うRESTエンドポイント
- `boards/route.ts` - 掲示板のCRUD操作
- `boards/[boardId]/threads/route.ts` - 特定掲示板のスレッド操作
- 日本語メッセージによるエラーハンドリング

**ページ** (`app/`)：
- 非同期コンポーネントを使用するサーバーサイドレンダリングページ
- ページコンポーネント内でPrismaクエリを直接実行（内部API呼び出し不要）
- ネストしたルーティング：`/boards/[boardId]` → `/boards/[boardId]/threads/new`

**データベースクライアント** (`lib/prisma.ts`)：
- 開発時のグローバルキャッシングを持つシングルトンパターン
- デバッグ用のクエリログ有効化

### 主要な技術パターン

1. **IPベースユーザーシステム**: 従来の認証なし - ハッシュ化されたIPアドレスでユーザーを識別
2. **直接データベースアクセス**: ページは内部APIを呼び出さずPrismaに直接クエリ
3. **日本語ローカライゼーション**: 全UIテキストとエラーメッセージが日本語
4. **匿名投稿**: アイデンティティ一貫性のためのオプションニックネームとトリップ

### インポートエイリアス
- `@/` はプロジェクトルートにマップ (tsconfig.jsonで設定)
- データベースアクセスには `@/lib/prisma` を使用
- TypeScriptインターフェースには `@/app/types` を使用